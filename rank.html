<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perbandingan Peringkat THE Impact SDG (2024 vs 2025)</title>
    <!-- Muat Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        /* Custom Styles for Rank Indicators */
        .rank-up { color: #059669; font-weight: bold; } /* Green for Improvement */
        .rank-down { color: #dc2626; font-weight: bold; } /* Red for Decline */
        .rank-stable { color: #4b5563; } /* Gray for Stable */
        .rank-new { background-color: #bfdbfe; color: #1e40af; } /* Blue for New Entry */
        .rank-na { color: #9ca3af; } /* Gray for Not Applicable */

        /* Sticky elements for better scrolling experience */
        .sticky-col {
            position: sticky;
            left: 0;
            background-color: white;
            z-index: 20;
        }
        /* Styling for the highlighted university (USK) */
        .highlight-row {
            background-color: #fffbeb !important; /* light yellow/gold background */
            font-weight: 600;
        }
        .highlight-col {
            background-color: #fef3c7 !important; /* slightly darker yellow for sticky column */
            font-weight: 700 !important;
        }
        .sticky-head {
            position: sticky;
            top: 0;
            z-index: 10;
        }
    </style>
</head>
<body>

    <div class="min-h-screen flex flex-col items-center p-2 sm:p-4">
        <!-- Header -->
        <header class="w-full max-w-7xl mb-6 p-4 rounded-xl shadow-xl text-white bg-gradient-to-r from-teal-600 to-sky-700">
            <h1 class="text-2xl sm:text-3xl font-extrabold mb-1">Tabel Komparatif Peringkat THE Impact SDG</h1>
            <p class="text-md sm:text-lg font-light">Perbandingan Kinerja Universitas Indonesia: 2024 vs 2025</p>
        </header>

        <!-- Main Content Card -->
        <div class="w-full max-w-7xl bg-white rounded-xl shadow-2xl p-4 sm:p-6">

            <h2 class="text-xl font-bold text-gray-800 mb-4 border-b-2 border-teal-500 pb-2">Perbandingan Peringkat Keseluruhan</h2>

            <!-- Responsive Table Container -->
            <div class="overflow-x-auto rounded-lg shadow-inner border border-gray-200">
                <table class="min-w-full divide-y divide-gray-300">
                    <!-- Table Header -->
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" rowspan="2" class="sticky-col sticky-head bg-gray-100 border-r border-gray-300 px-4 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Universitas</th>
                            
                            <!-- 2024 Block -->
                            <th scope="col" colspan="3" class="sticky-head border-r border-gray-300 px-4 py-1 text-center text-xs font-bold text-gray-700 uppercase tracking-wider bg-teal-200">Peringkat 2024</th>
                            
                            <!-- 2025 Block -->
                            <th scope="col" colspan="3" class="sticky-head px-4 py-1 text-center text-xs font-bold text-gray-700 uppercase tracking-wider bg-sky-200">Peringkat 2025</th>
                        </tr>
                        <tr>
                            <!-- 2024 Sub Headers -->
                            <th scope="col" class="sticky-head px-3 py-1 text-center text-xs font-medium text-gray-600 uppercase tracking-wider bg-teal-100">Dom. Rank</th>
                            <th scope="col" class="sticky-head px-3 py-1 text-center text-xs font-medium text-gray-600 uppercase tracking-wider bg-teal-100">Global Rank</th>
                            <th scope="col" class="sticky-head border-r border-gray-300 px-3 py-1 text-center text-xs font-medium text-gray-600 uppercase tracking-wider bg-teal-100">Overall Score</th>

                            <!-- 2025 Sub Headers -->
                            <th scope="col" class="sticky-head px-3 py-1 text-center text-xs font-medium text-gray-600 uppercase tracking-wider bg-sky-100">Dom. Rank</th>
                            <th scope="col" class="sticky-head px-3 py-1 text-center text-xs font-medium text-gray-600 uppercase tracking-wider bg-sky-100">Global Rank</th>
                            <th scope="col" class="sticky-head px-3 py-1 text-center text-xs font-medium text-gray-600 uppercase tracking-wider bg-sky-100">Overall Score</th>
                        </tr>
                    </thead>
                    <!-- Table Body will be rendered by JavaScript -->
                    <tbody id="rankingTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Rows go here -->
                    </tbody>
                </table>
            </div>

            <div class="mt-6 text-sm text-gray-500">
                <p><strong>Peringkat Domestik:</strong> Dihitung berdasarkan kesamaan Global Rank (Dense Ranking). Tanda <strong>=</strong> (di depan angka, contoh: **=5**) menunjukkan peringkat yang dibagi dengan universitas lain.</p>
                <p><strong>Urutan Tabel:</strong> Diurutkan berdasarkan Peringkat Domestik 2025 terbaru.</p>
            </div>

        </div>
    </div>

    <script>
        // Data mentah, menghilangkan kolom Best SDG/Score
        const rawData2024 = [
            { name: 'University of Indonesia', globalRank: '31', score: '93.7' },
            { name: 'Universitas Airlangga', globalRank: '=81', score: '90.3' },
            { name: 'IPB University', globalRank: '94', score: '89.6' },
            { name: 'Universitas Gadjah Mada', globalRank: '101–200', score: '84.0–89.1' },
            { name: 'Institut Teknologi Bandung', globalRank: '201–300', score: '79.3–83.9' },
            { name: 'Institut Teknologi Sepuluh Nopember', globalRank: '201–300', score: '79.3–83.9' },
            { name: 'Diponegoro University', globalRank: '301–400', score: '75.8–79.2' },
            { name: 'Telkom University', globalRank: '301–400', score: '75.8–79.2' },
            { name: 'Universitas Padjadjaran', globalRank: '301–400', score: '75.8–79.2' },
            { name: 'BINUS University', globalRank: '401–600', score: '69.9–75.7' },
            { name: 'Hasanuddin University', globalRank: '401–600', score: '69.9–75.7' },
            { name: 'University of Brawijaya', globalRank: '401–600', score: '69.9–75.7' },
            { name: 'State University of Malang', globalRank: '601–800', score: '64.5–69.8' },
            { name: 'Universitas Muhammadiyah Yogyakarta', globalRank: '601–800', score: '64.5–69.8' },
            { name: 'Universitas Negeri Surabaya', globalRank: '601–800', score: '64.5–69.8' },
            { name: 'Universitas Sebelas Maret', globalRank: '601–800', score: '64.5–69.8' },
            { name: 'Universitas Sumatera Utara', globalRank: '601–800', score: '64.5–69.8' },
            { name: 'Bakrie University', globalRank: '801–1000', score: '58.8–64.4' },
            { name: 'Universitas Negeri Yogyakarta', globalRank: '801–1000', score: '58.8–64.4' },
            { name: 'Universitas Sriwijaya', globalRank: '801–1000', score: '58.8–64.4' },
            { name: 'Universitas Syiah Kuala', globalRank: '801–1000', score: '58.8–64.4' },
        ];

        const rawData2025 = [
            { name: 'Universitas Airlangga', globalRank: '=9', score: '96.9' },
            { name: 'University of Indonesia', globalRank: '30', score: '94.4' },
            { name: 'Universitas Gadjah Mada', globalRank: '=82', score: '90.3' },
            { name: 'IPB University', globalRank: '101–200', score: '83.7–89.4' },
            { name: 'Institut Teknologi Bandung', globalRank: '201–300', score: '79.4–83.6' },
            { name: 'Institut Teknologi Sepuluh Nopember', globalRank: '201–300', score: '79.4–83.6' },
            { name: 'Universitas Padjadjaran', globalRank: '201–300', score: '79.4–83.6' },
            { name: 'BINUS University', globalRank: '301–400', score: '76.2–79.3' },
            { name: 'Diponegoro University', globalRank: '301–400', score: '76.2–79.3' },
            { name: 'Universitas Sebelas Maret', globalRank: '301–400', score: '76.2–79.3' },
            { name: 'Hasanuddin University', globalRank: '401–600', score: '70.3–76.1' },
            { name: 'Telkom University', globalRank: '401–600', score: '70.3–76.1' },
            { name: 'Universitas Pelita Harapan', globalRank: '401–600', score: '70.3–76.1' },
            { name: 'University of Brawijaya', globalRank: '401–600', score: '70.3–76.1' },
            { name: 'State University of Malang', globalRank: '601–800', score: '65.6–70.2' },
            { name: 'Universitas Andalas', globalRank: '601–800', score: '65.6–70.2' },
            { name: 'Universitas Muhammadiyah Yogyakarta', globalRank: '601–800', score: '65.6–70.2' },
            { name: 'Universitas Negeri Surabaya', globalRank: '601–800', score: '65.6–70.2' },
            { name: 'Universitas Sriwijaya', globalRank: '601–800', score: '65.6–70.2' },
            { name: 'Universitas Syiah Kuala', globalRank: '601–800', score: '65.6–70.2' },
        ];

        // Konstanta untuk nama universitas yang ingin disorot
        const HIGHLIGHT_UNIVERSITY = 'Universitas Syiah Kuala';

        /**
         * Menguraikan string Global Rank menjadi nilai numerik untuk tujuan sorting.
         * Nilai yang lebih kecil lebih baik.
         */
        const parseRankValue = (rankStr) => {
            if (!rankStr) return Infinity;
            
            // Prioritas: Angka Tepat / Angka Bersama (=) -> Rentang Rank
            const matchExact = rankStr.match(/^=?(\d+)/);
            if (matchExact) {
                return parseInt(matchExact[1], 10);
            }
            
            // Mengambil batas bawah untuk Rentang Rank
            const matchRange = rankStr.match(/^(\d+)–\d+/);
            if (matchRange) {
                // Beri bobot lebih rendah pada rentang rank agar berada di belakang rank pasti (diberi offset 10000)
                return parseInt(matchRange[1], 10) + 10000;
            }
            
            return Infinity;
        };

        /**
         * Menghitung Peringkat Domestik berdasarkan Global Rank (Dense Ranking Logic: 1, 2, 2, 3, 3, 3, 4).
         * Peringkat hanya bertambah ketika Global Rank-nya berbeda.
         * Juga menentukan apakah peringkat tersebut dibagi (shared).
         */
        const calculateDomesticRanks = (data) => {
            // 1. Sort data berdasarkan nilai Global Rank yang diurai (ascending)
            const sortedData = [...data].sort((a, b) => {
                const rankA = parseRankValue(a.globalRank);
                const rankB = parseRankValue(b.globalRank);
                return rankA - rankB;
            });

            if (sortedData.length === 0) return [];

            let currentDomesticRank = 0;
            let prevGlobalRank = null;
            
            // Map untuk menyimpan jumlah universitas per Domestic Rank (untuk mendeteksi sharing)
            const rankGroups = {}; 

            // Fase 1: Hitung Peringkat Domestik
            for (let i = 0; i < sortedData.length; i++) {
                const currentGlobalRank = sortedData[i].globalRank;
                
                // Dense Ranking: hanya increment jika Global Rank berbeda
                if (currentGlobalRank !== prevGlobalRank) {
                    currentDomesticRank++;
                }

                sortedData[i].domesticRank = currentDomesticRank;
                
                // Hitung berapa banyak universitas yang mendapatkan Domestic Rank ini
                rankGroups[currentDomesticRank] = (rankGroups[currentDomesticRank] || 0) + 1;
                
                prevGlobalRank = currentGlobalRank;
            }
            
            // Fase 2: Tetapkan status Shared Rank
            for (const item of sortedData) {
                // Peringkat dibagikan jika kelompok peringkat tersebut memiliki lebih dari 1 anggota
                item.isSharedRank = (rankGroups[item.domesticRank] > 1);
            }

            return sortedData;
        };
        
        // Hitung peringkat domestik untuk kedua tahun
        const rankedData2024 = calculateDomesticRanks(rawData2024);
        const rankedData2025 = calculateDomesticRanks(rawData2025);

        // Gabungkan data ke objek perbandingan
        const mergedData = {};

        // Fungsi helper untuk memetakan data
        const mapData = (data, year) => {
            data.forEach(item => {
                // Inisialisasi struktur jika belum ada
                if (!mergedData[item.name]) {
                    mergedData[item.name] = { 
                        name: item.name, 
                        '2024': { domesticRank: null, globalRank: null, score: null, isSharedRank: false }, 
                        '2025': { domesticRank: null, globalRank: null, score: null, isSharedRank: false } 
                    };
                }
                // Assign data spesifik tahun tersebut
                mergedData[item.name][year] = {
                    domesticRank: item.domesticRank,
                    globalRank: item.globalRank,
                    score: item.score,
                    isSharedRank: item.isSharedRank
                };
            });
        };
        
        // Map data 2024
        mapData(rankedData2024, '2024');

        // Map data 2025
        mapData(rankedData2025, '2025'); 
        
        let finalRankings = Object.values(mergedData);

        // Urutkan data akhir berdasarkan Peringkat Domestik 2025, lalu 2024, lalu nama
        finalRankings.sort((a, b) => {
            // Gunakan Infinity untuk N/A agar berada di paling bawah
            const rank25A = a['2025'].domesticRank !== null ? a['2025'].domesticRank : Infinity;
            const rank25B = b['2025'].domesticRank !== null ? b['2025'].domesticRank : Infinity;
            const rank24A = a['2024'].domesticRank !== null ? a['2024'].domesticRank : Infinity;
            const rank24B = b['2024'].domesticRank !== null ? b['2024'].domesticRank : Infinity;

            if (rank25A !== rank25B) return rank25A - rank25B;
            if (rank24A !== rank24B) return rank24A - rank24B;
            return a.name.localeCompare(b.name);
        });
        
        /**
         * Mendapatkan HTML untuk Peringkat Domestik dengan indikator Shared Rank
         * Menggunakan '=RANK' jika isShared = true.
         */
        const getDomesticRankHtml = (data, year) => {
            const rank = data[year].domesticRank;
            const isShared = data[year].isSharedRank;

            if (rank === null) return `<span class="rank-na">N/A</span>`;
            
            // Jika dibagikan, tampilkan '=' di depan angka
            const formattedRank = isShared ? `=${rank}` : `${rank}`;
            return `<span class="font-bold text-gray-800">${formattedRank}</span>`;
        };

        // Render data ke tabel utama
        const renderMainTable = () => {
            const tbody = document.getElementById('rankingTableBody');
            tbody.innerHTML = '';

            finalRankings.forEach(item => {
                const data24 = item['2024'];
                const data25 = item['2025'];
                
                // Cek apakah baris saat ini adalah USK
                const isHighlight = item.name === HIGHLIGHT_UNIVERSITY;
                
                // Tentukan kelas CSS untuk baris dan kolom sticky
                const rowClass = isHighlight ? 'highlight-row' : 'hover:bg-gray-100';
                const stickyColClass = isHighlight ? 'highlight-col' : 'bg-white';
                const cell24Class = isHighlight ? 'bg-teal-50/70' : 'bg-teal-50'; // Sedikit redup jika disorot
                const cell25Class = isHighlight ? 'bg-sky-50/70' : 'bg-sky-50'; // Sedikit redup jika disorot
                const score24Class = isHighlight ? 'bg-teal-100/70' : 'bg-teal-100';
                const score25Class = isHighlight ? 'bg-sky-100/70' : 'bg-sky-100';

                const row = `
                    <tr class="${rowClass} transition duration-150 ease-in-out">
                        <td class="sticky-col border-r border-gray-300 px-4 py-3 whitespace-nowrap text-sm font-bold text-gray-900 ${stickyColClass}">
                            ${item.name}
                        </td>
                        
                        <!-- 2024 Data -->
                        <td class="px-3 py-3 text-center text-sm ${cell24Class}">
                            ${getDomesticRankHtml(item, '2024')}
                        </td>
                        <td class="px-3 py-3 text-center text-sm text-gray-600 ${cell24Class}">
                            ${data24.globalRank || '<span class="rank-na">N/A</span>'}
                        </td>
                        <td class="px-3 py-3 border-r border-gray-300 text-center text-sm font-semibold text-teal-800 ${score24Class}">
                            ${data24.score || '<span class="rank-na">N/A</span>'}
                        </td>

                        <!-- 2025 Data -->
                        <td class="px-3 py-3 text-center text-sm ${cell25Class}">
                            ${getDomesticRankHtml(item, '2025')}
                        </td>
                        <td class="px-3 py-3 text-center text-sm text-gray-600 ${cell25Class}">
                            ${data25.globalRank || '<span class="rank-na">N/A</span>'}
                        </td>
                        <td class="px-3 py-3 text-center text-sm font-semibold text-sky-800 ${score25Class}">
                            ${data25.score || '<span class="rank-na">N/A</span>'}
                        </td>
                    </tr>
                `;
                tbody.insertAdjacentHTML('beforeend', row);
            });
        };

        document.addEventListener('DOMContentLoaded', () => {
            renderMainTable();
        });
    </script>

</body>
</html>
